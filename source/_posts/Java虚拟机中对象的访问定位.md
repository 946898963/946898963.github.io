---
title: Java虚拟机中对象的访问定位
date: 2016-05-31 18:48:23
categories:
- 技术
- JVM
tags:
- JVM
---


java程序需要通过java虚拟机栈上的reference数据来操作堆上的具体对象。究竟如何通过reference数据访问对象取决于java虚拟机的实现，目前主流的访问方式有两种:
> * 使用句柄
> * 直接指针


如果使用句柄访问的话，需要在java堆中划分出一块内存来作为句柄池，reference中存储的就是对象的句柄池地址，而句柄中包含了对象的实例数据跟类型数据各自的具体地址信息。

![句柄](Java虚拟机中对象的访问定位/jubing.jpg)

使用直接指针的话，reference中存储的就是对象的直接地址，这时候在对象的布局中就必须考虑如何放置访问类型数据的相关信息。

![指针](Java虚拟机中对象的访问定位/zhizhen.jpg)

句柄访问的优势：reference中存储的是对象的句柄的地址，当对象的被移动（垃圾收集时对象被移动是很常见的事情）时只会改变句柄中的实例数据的指针，而reference数据本身不需要修改。

直接指针方式的优势：速度快，节省了一次指针定位的开销，由于对象的访问在java中是非常频繁的，因此这类开销积少成多后，也是一笔非常可观的执行成本。

在Sun HotSpot中，使用的是直接指针的方式来访问对象的。